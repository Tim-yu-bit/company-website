<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ‰“é£æœº - ç‰›é©¬ä¹‹å®¶</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            font-family: Arial, sans-serif;
            color: white;
        }

        .game-container {
            text-align: center;
            background: rgba(255,255,255,0.1);
            padding: 30px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
        }

        h1 {
            margin-bottom: 20px;
            font-size: 2.5rem;
        }

        #gameCanvas {
            border: 4px solid white;
            background: #0a0a2e;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .info {
            margin-top: 20px;
            display: flex;
            justify-content: space-around;
            font-size: 1.3rem;
            font-weight: bold;
        }

        .power-info {
            margin-top: 10px;
            font-size: 1rem;
            color: #ffd700;
        }

        .controls {
            margin-top: 20px;
            font-size: 1.1rem;
            line-height: 1.6;
        }

        button {
            margin-top: 15px;
            padding: 12px 30px;
            font-size: 1.1rem;
            background: white;
            color: #667eea;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: transform 0.2s;
        }

        button:hover {
            transform: scale(1.05);
        }

        .back-btn {
            margin-left: 10px;
            background: rgba(255,255,255,0.2);
            color: white;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1>âœˆï¸ æ‰“é£æœº å¢å¼ºç‰ˆ</h1>
        <div class="info">
            <div>å¾—åˆ†: <span id="score">0</span></div>
            <div>ç”Ÿå‘½: <span id="lives">3</span></div>
        </div>
        <div class="power-info" id="powerInfo">ğŸ”« å•å‘å°„å‡»</div>
        <canvas id="gameCanvas" width="400" height="600"></canvas>
        <div class="controls">
            â† â†’ â†‘ â†“ ç§»åŠ¨ | ç©ºæ ¼é”®å°„å‡»<br>
            æˆ–ç§»åŠ¨é¼ æ ‡æ§åˆ¶é£æœº<br>
            ğŸ’ æ”¶é›†é“å…·æå‡ç«åŠ›ï¼âš¡ å°„é€Ÿæå‡ï¼
        </div>
        <button onclick="resetGame()">é‡æ–°å¼€å§‹</button>
        <button class="back-btn" onclick="window.location.href='../games.html'">è¿”å›</button>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const scoreElement = document.getElementById('score');
        const livesElement = document.getElementById('lives');
        const powerInfoElement = document.getElementById('powerInfo');

        // ç©å®¶é£æœº
        const player = {
            x: canvas.width / 2 - 20,
            y: canvas.height - 80,
            width: 40,
            height: 40,
            speed: 6,
            dx: 0,
            dy: 0, // æ·»åŠ å‚ç›´ç§»åŠ¨
            fireLevel: 1, // ç«åŠ›ç­‰çº§ï¼š1-å•å‘ï¼Œ2-åŒå‘ï¼Œ3-ä¸‰å‘
            shield: 0, // æŠ¤ç›¾
            rapidFire: 0 // å°„é€ŸåŠ æˆæ—¶é—´ï¼ˆç§’ï¼‰
        };

        // æ¸¸æˆçŠ¶æ€
        let score = 0;
        let lives = 3;
        let gameRunning = true;
        let bullets = [];
        let enemies = [];
        let powerUps = [];
        let explosions = [];
        let lastShot = 0;
        let shootDelay = 120; // æ›´å¿«çš„å°„å‡»é¢‘ç‡

        // æ•Œæœºç”Ÿæˆ
        let lastEnemy = 0;
        let enemyDelay = 1000;

        // é“å…·ç”Ÿæˆ
        let lastPowerUp = 0;
        let powerUpDelay = 8000;

        // ç»˜åˆ¶ç©å®¶é£æœº
        function drawPlayer() {
            // æŠ¤ç›¾æ•ˆæœ
            if (player.shield > 0) {
                ctx.strokeStyle = `rgba(0, 255, 255, ${player.shield / 100})`;
                ctx.lineWidth = 3;
                ctx.beginPath();
                ctx.arc(player.x + player.width / 2, player.y + player.height / 2, player.width, 0, Math.PI * 2);
                ctx.stroke();
            }

            // å°„é€ŸåŠ æˆæ•ˆæœ
            if (player.rapidFire > 0) {
                ctx.strokeStyle = `rgba(255, 200, 0, ${Math.min(player.rapidFire / 5, 1)})`;
                ctx.lineWidth = 2;
                for (let i = 0; i < 3; i++) {
                    ctx.beginPath();
                    ctx.arc(player.x + player.width / 2, player.y + player.height / 2, player.width + i * 5, 0, Math.PI * 2);
                    ctx.stroke();
                }
            }

            ctx.fillStyle = '#00ff00';
            // æœºèº«
            ctx.beginPath();
            ctx.moveTo(player.x + player.width / 2, player.y);
            ctx.lineTo(player.x, player.y + player.height);
            ctx.lineTo(player.x + player.width / 2, player.y + player.height * 0.8);
            ctx.lineTo(player.x + player.width, player.y + player.height);
            ctx.closePath();
            ctx.fill();

            // é©¾é©¶èˆ±
            ctx.fillStyle = '#00ffff';
            ctx.beginPath();
            ctx.arc(player.x + player.width / 2, player.y + player.height / 3, 8, 0, Math.PI * 2);
            ctx.fill();

            // ç«åŠ›ç­‰çº§æŒ‡ç¤º
            if (player.fireLevel > 1) {
                ctx.fillStyle = '#ffff00';
                ctx.font = '12px Arial';
                ctx.fillText(`Lv${player.fireLevel}`, player.x + player.width / 2 - 10, player.y - 5);
            }
        }

        // å­å¼¹ç±»
        class Bullet {
            constructor(x, y, offsetX = 0) {
                this.x = x + offsetX;
                this.y = y;
                this.width = 4;
                this.height = 15;
                this.speed = 10;
            }

            draw() {
                ctx.fillStyle = '#ffff00';
                ctx.fillRect(this.x, this.y, this.width, this.height);
                // å­å¼¹å°¾è¿¹
                ctx.fillStyle = 'rgba(255, 255, 0, 0.3)';
                ctx.fillRect(this.x, this.y + this.height, this.width, 10);
            }

            update() {
                this.y -= this.speed;
            }
        }

        // æ•Œæœºç±»
        class Enemy {
            constructor() {
                this.width = 35;
                this.height = 35;
                this.x = Math.random() * (canvas.width - this.width);
                this.y = -this.height;
                this.speed = 2 + Math.random() * 2;
                this.hp = 1;
            }

            draw() {
                ctx.fillStyle = '#ff0000';
                // æ•Œæœºæœºèº«
                ctx.beginPath();
                ctx.moveTo(this.x + this.width / 2, this.y + this.height);
                ctx.lineTo(this.x, this.y);
                ctx.lineTo(this.x + this.width / 2, this.y + this.height * 0.3);
                ctx.lineTo(this.x + this.width, this.y);
                ctx.closePath();
                ctx.fill();
            }

            update() {
                this.y += this.speed;
            }
        }

        // é“å…·ç±»
        class PowerUp {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                this.width = 25;
                this.height = 25;
                this.speed = 2;
                // éšæœºé“å…·ç±»å‹
                const rand = Math.random();
                if (rand < 0.3) {
                    this.type = 'fireUp'; // ç«åŠ›æå‡
                    this.color = '#ff0000';
                    this.symbol = 'ğŸ”¥';
                } else if (rand < 0.5) {
                    this.type = 'shield'; // æŠ¤ç›¾
                    this.color = '#00ffff';
                    this.symbol = 'ğŸ›¡ï¸';
                } else if (rand < 0.7) {
                    this.type = 'rapidFire'; // å°„é€Ÿæå‡
                    this.color = '#ffa500';
                    this.symbol = 'âš¡';
                } else {
                    this.type = 'life'; // ç”Ÿå‘½
                    this.color = '#00ff00';
                    this.symbol = 'â¤ï¸';
                }
            }

            draw() {
                // å‘å…‰æ•ˆæœ
                ctx.shadowBlur = 15;
                ctx.shadowColor = this.color;

                // é“å…·å¤–æ¡†
                ctx.strokeStyle = this.color;
                ctx.lineWidth = 2;
                ctx.strokeRect(this.x, this.y, this.width, this.height);

                // é“å…·ç¬¦å·
                ctx.font = '20px Arial';
                ctx.fillText(this.symbol, this.x + 3, this.y + 20);

                ctx.shadowBlur = 0;
            }

            update() {
                this.y += this.speed;
            }
        }

        // çˆ†ç‚¸æ•ˆæœç±»
        class Explosion {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                this.radius = 5;
                this.maxRadius = 30;
                this.speed = 3;
            }

            draw() {
                ctx.strokeStyle = `rgba(255, ${255 - this.radius * 5}, 0, ${1 - this.radius / this.maxRadius})`;
                ctx.lineWidth = 3;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                ctx.stroke();
            }

            update() {
                this.radius += this.speed;
                return this.radius < this.maxRadius;
            }
        }

        // å°„å‡»ï¼ˆæ ¹æ®ç«åŠ›ç­‰çº§ï¼‰
        function shoot() {
            const now = Date.now();
            // å°„é€ŸåŠ æˆï¼šå‡å°‘50%å†·å´æ—¶é—´
            const currentDelay = player.rapidFire > 0 ? shootDelay * 0.5 : shootDelay;

            if (now - lastShot > currentDelay) {
                const centerX = player.x + player.width / 2 - 2;

                if (player.fireLevel === 1) {
                    // å•å‘
                    bullets.push(new Bullet(centerX, player.y));
                } else if (player.fireLevel === 2) {
                    // åŒå‘
                    bullets.push(new Bullet(centerX, player.y, -10));
                    bullets.push(new Bullet(centerX, player.y, 10));
                } else if (player.fireLevel >= 3) {
                    // ä¸‰å‘
                    bullets.push(new Bullet(centerX, player.y, -15));
                    bullets.push(new Bullet(centerX, player.y, 0));
                    bullets.push(new Bullet(centerX, player.y, 15));
                }

                lastShot = now;
            }
        }

        // ç”Ÿæˆæ•Œæœº
        function spawnEnemy() {
            const now = Date.now();
            if (now - lastEnemy > enemyDelay) {
                enemies.push(new Enemy());
                lastEnemy = now;
                // éšç€åˆ†æ•°å¢åŠ ï¼Œæ•Œæœºç”Ÿæˆæ›´å¿«
                enemyDelay = Math.max(400, 1000 - score / 10);
            }
        }

        // ç”Ÿæˆé“å…·
        function spawnPowerUp() {
            const now = Date.now();
            if (now - lastPowerUp > powerUpDelay) {
                const x = Math.random() * (canvas.width - 25);
                powerUps.push(new PowerUp(x, -25));
                lastPowerUp = now;
            }
        }

        // æ›´æ–°ç«åŠ›æ˜¾ç¤º
        function updatePowerInfo() {
            let text = '';
            if (player.fireLevel === 1) text = 'ğŸ”« å•å‘å°„å‡»';
            else if (player.fireLevel === 2) text = 'ğŸ”«ğŸ”« åŒå‘å°„å‡»';
            else text = 'ğŸ”«ğŸ”«ğŸ”« ä¸‰å‘å°„å‡»';

            if (player.rapidFire > 0) text += ' | âš¡ å°„é€Ÿx2';
            if (player.shield > 0) text += ' | ğŸ›¡ï¸ æŠ¤ç›¾';

            powerInfoElement.textContent = text;
        }

        // ç¢°æ’æ£€æµ‹
        function checkCollision(rect1, rect2) {
            return rect1.x < rect2.x + rect2.width &&
                   rect1.x + rect1.width > rect2.x &&
                   rect1.y < rect2.y + rect2.height &&
                   rect1.y + rect1.height > rect2.y;
        }

        // ç§»åŠ¨ç©å®¶
        function movePlayer() {
            player.x += player.dx;
            player.y += player.dy;

            // è¾¹ç•Œæ£€æµ‹
            if (player.x < 0) player.x = 0;
            if (player.x + player.width > canvas.width) {
                player.x = canvas.width - player.width;
            }
            if (player.y < 0) player.y = 0;
            if (player.y + player.height > canvas.height) {
                player.y = canvas.height - player.height;
            }
        }

        // ç»˜åˆ¶æ˜Ÿæ˜ŸèƒŒæ™¯
        const stars = [];
        for (let i = 0; i < 50; i++) {
            stars.push({
                x: Math.random() * canvas.width,
                y: Math.random() * canvas.height,
                radius: Math.random() * 2,
                speed: Math.random() * 2 + 1
            });
        }

        function drawStars() {
            ctx.fillStyle = '#ffffff';
            stars.forEach(star => {
                ctx.beginPath();
                ctx.arc(star.x, star.y, star.radius, 0, Math.PI * 2);
                ctx.fill();
                star.y += star.speed;
                if (star.y > canvas.height) {
                    star.y = 0;
                    star.x = Math.random() * canvas.width;
                }
            });
        }

        // æ¸¸æˆä¸»å¾ªç¯
        function gameLoop() {
            if (!gameRunning) return;

            // æ¸…ç©ºç”»å¸ƒ
            ctx.fillStyle = '#0a0a2e';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // ç»˜åˆ¶æ˜Ÿæ˜Ÿ
            drawStars();

            // ç§»åŠ¨ç©å®¶
            movePlayer();

            // ç»˜åˆ¶ç©å®¶
            drawPlayer();

            // ç”Ÿæˆæ•Œæœº
            spawnEnemy();

            // ç”Ÿæˆé“å…·
            spawnPowerUp();

            // æŠ¤ç›¾è¡°å‡
            if (player.shield > 0) {
                player.shield -= 0.5;
            }

            // å°„é€ŸåŠ æˆè¡°å‡
            if (player.rapidFire > 0) {
                player.rapidFire -= 1/60; // æ¯å¸§å‡å°‘1/60ç§’
                if (player.rapidFire <= 0) {
                    player.rapidFire = 0;
                    updatePowerInfo();
                }
            }

            // æ›´æ–°å’Œç»˜åˆ¶é“å…·
            powerUps = powerUps.filter(powerUp => {
                powerUp.update();
                powerUp.draw();

                // æ£€æŸ¥ç©å®¶æ‹¾å–
                if (checkCollision(player, powerUp)) {
                    if (powerUp.type === 'fireUp') {
                        player.fireLevel = Math.min(3, player.fireLevel + 1);
                    } else if (powerUp.type === 'shield') {
                        player.shield = 100;
                    } else if (powerUp.type === 'rapidFire') {
                        player.rapidFire = 10; // æŒç»­10ç§’
                    } else if (powerUp.type === 'life') {
                        lives = Math.min(5, lives + 1);
                        livesElement.textContent = lives;
                    }
                    updatePowerInfo();
                    return false;
                }

                return powerUp.y < canvas.height;
            });

            // æ›´æ–°å’Œç»˜åˆ¶å­å¼¹
            bullets = bullets.filter(bullet => {
                bullet.update();
                bullet.draw();
                return bullet.y > -bullet.height;
            });

            // æ›´æ–°å’Œç»˜åˆ¶æ•Œæœº
            enemies = enemies.filter(enemy => {
                enemy.update();
                enemy.draw();

                // æ£€æŸ¥å­å¼¹ç¢°æ’
                for (let i = bullets.length - 1; i >= 0; i--) {
                    if (checkCollision(bullets[i], enemy)) {
                        bullets.splice(i, 1);
                        explosions.push(new Explosion(enemy.x + enemy.width / 2, enemy.y + enemy.height / 2));
                        score += 10;
                        scoreElement.textContent = score;
                        return false;
                    }
                }

                // æ£€æŸ¥ç©å®¶ç¢°æ’
                if (checkCollision(player, enemy)) {
                    explosions.push(new Explosion(enemy.x + enemy.width / 2, enemy.y + enemy.height / 2));

                    if (player.shield > 0) {
                        // æœ‰æŠ¤ç›¾ï¼Œåªæ¶ˆè€—æŠ¤ç›¾
                        player.shield = 0;
                        updatePowerInfo();
                    } else {
                        // æ— æŠ¤ç›¾ï¼Œæ‰£ç”Ÿå‘½
                        lives--;
                        livesElement.textContent = lives;
                        // æ‰£ç”Ÿå‘½åç«åŠ›ä¸‹é™
                        player.fireLevel = Math.max(1, player.fireLevel - 1);
                        updatePowerInfo();

                        if (lives === 0) {
                            gameOver();
                        }
                    }
                    return false;
                }

                return enemy.y < canvas.height;
            });

            // æ›´æ–°å’Œç»˜åˆ¶çˆ†ç‚¸
            explosions = explosions.filter(explosion => {
                explosion.draw();
                return explosion.update();
            });

            requestAnimationFrame(gameLoop);
        }

        function gameOver() {
            gameRunning = false;
            ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = 'white';
            ctx.font = '40px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('æ¸¸æˆç»“æŸ!', canvas.width / 2, canvas.height / 2 - 20);
            ctx.font = '24px Arial';
            ctx.fillText('å¾—åˆ†: ' + score, canvas.width / 2, canvas.height / 2 + 20);
        }

        function resetGame() {
            player.x = canvas.width / 2 - 20;
            player.y = canvas.height - 80;
            player.dx = 0;
            player.dy = 0;
            player.fireLevel = 1;
            player.shield = 0;
            player.rapidFire = 0;
            score = 0;
            lives = 3;
            bullets = [];
            enemies = [];
            powerUps = [];
            explosions = [];
            scoreElement.textContent = score;
            livesElement.textContent = lives;
            updatePowerInfo();
            gameRunning = true;
            lastEnemy = 0;
            lastPowerUp = 0;
            enemyDelay = 1000;
            gameLoop();
        }

        // é”®ç›˜æ§åˆ¶
        let keys = {};
        document.addEventListener('keydown', (e) => {
            keys[e.key] = true;
            if (e.key === ' ') {
                e.preventDefault();
                shoot();
            }
        });

        document.addEventListener('keyup', (e) => {
            keys[e.key] = false;
        });

        // æŒç»­ç§»åŠ¨
        setInterval(() => {
            if (keys['ArrowLeft']) player.dx = -player.speed;
            else if (keys['ArrowRight']) player.dx = player.speed;
            else player.dx = 0;

            if (keys['ArrowUp']) player.dy = -player.speed;
            else if (keys['ArrowDown']) player.dy = player.speed;
            else player.dy = 0;
        }, 1000 / 60);

        // é¼ æ ‡æ§åˆ¶
        canvas.addEventListener('mousemove', (e) => {
            const rect = canvas.getBoundingClientRect();
            player.x = e.clientX - rect.left - player.width / 2;
        });

        canvas.addEventListener('click', () => {
            shoot();
        });

        // è‡ªåŠ¨å°„å‡»ï¼ˆæ›´å¿«é¢‘ç‡ï¼‰
        setInterval(() => {
            if (gameRunning) shoot();
        }, 150);

        // å¼€å§‹æ¸¸æˆ
        updatePowerInfo();
        gameLoop();
    </script>
</body>
</html>
