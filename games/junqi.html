<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å†›æ£‹å¯¹æˆ˜ - ç‰›é©¬ä¹‹å®¶</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            font-family: Arial, sans-serif;
            color: white;
        }

        .game-container {
            text-align: center;
            background: rgba(255,255,255,0.1);
            padding: 30px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
            max-width: 700px;
        }

        h1 {
            margin-bottom: 20px;
            font-size: 2.5rem;
        }

        .info {
            margin-bottom: 20px;
            font-size: 1.2rem;
        }

        #gameBoard {
            background: #8B4513;
            border: 4px solid #654321;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            margin: 0 auto;
        }

        .controls {
            margin-top: 20px;
            font-size: 1rem;
            line-height: 1.8;
        }

        button {
            margin: 15px 5px 0;
            padding: 12px 30px;
            font-size: 1.1rem;
            background: white;
            color: #667eea;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: transform 0.2s;
        }

        button:hover {
            transform: scale(1.05);
        }

        .back-btn {
            background: rgba(255,255,255,0.2);
            color: white;
        }

        .legend {
            margin-top: 20px;
            font-size: 0.9rem;
            line-height: 1.6;
            text-align: left;
            background: rgba(0,0,0,0.3);
            padding: 15px;
            border-radius: 10px;
        }

        .legend-title {
            font-size: 1.1rem;
            font-weight: bold;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1>ğŸ–ï¸ å†›æ£‹å¯¹æˆ˜</h1>
        <div class="info">
            <div id="turn">è“æ–¹å›åˆ</div>
            <div id="status"></div>
        </div>
        <canvas id="gameBoard" width="600" height="500"></canvas>
        <div class="legend">
            <div class="legend-title">æ£‹å­è¯´æ˜ï¼š</div>
            å¸ä»¤>å†›é•¿>å¸ˆé•¿>æ—…é•¿>å›¢é•¿>è¥é•¿>è¿é•¿>æ’é•¿>å·¥å…µ<br>
            ç‚¸å¼¹å¯ä¸ä»»ä½•æ£‹å­åŒå½’äºå°½<br>
            å·¥å…µå¯ä»¥æ’é™¤åœ°é›·<br>
            åœ°é›·å¯ç‚¸é™¤å·¥å…µå¤–çš„æ‰€æœ‰æ£‹å­
        </div>
        <div class="controls">
            è“æ–¹ï¼ˆç©å®¶ï¼‰ vs çº¢æ–¹ï¼ˆç”µè„‘ï¼‰<br>
            ç‚¹å‡»å·±æ–¹æ£‹å­é€‰æ‹©ï¼Œå†ç‚¹å‡»ç›®æ ‡ä½ç½®ç§»åŠ¨æˆ–æ”»å‡»
        </div>
        <button onclick="resetGame()">é‡æ–°å¼€å§‹</button>
        <button class="back-btn" onclick="window.location.href='../games.html'">è¿”å›</button>
    </div>

    <script>
        const canvas = document.getElementById('gameBoard');
        const ctx = canvas.getContext('2d');
        const turnElement = document.getElementById('turn');
        const statusElement = document.getElementById('status');

        const CELL_SIZE = 50;
        const ROWS = 10;
        const COLS = 12;

        let selectedPiece = null;
        let currentPlayer = 'blue';
        let gameOver = false;

        // æ£‹å­ç­‰çº§
        const ranks = {
            'å¸': 9, 'å†›': 8, 'å¸ˆ': 7, 'æ—…': 6, 'å›¢': 5,
            'è¥': 4, 'è¿': 3, 'æ’': 2, 'å·¥': 1, 'é›·': 0, 'å¼¹': -1, 'æ——': -2
        };

        // åˆå§‹åŒ–æ£‹å­
        function initPieces() {
            const bluePieces = [
                {type: 'å¸', player: 'blue', x: 1, y: 0, visible: true},
                {type: 'å†›', player: 'blue', x: 2, y: 0, visible: true},
                {type: 'å¸ˆ', player: 'blue', x: 3, y: 0, visible: true},
                {type: 'æ—…', player: 'blue', x: 4, y: 0, visible: true},
                {type: 'å›¢', player: 'blue', x: 5, y: 0, visible: true},
                {type: 'å›¢', player: 'blue', x: 6, y: 0, visible: true},
                {type: 'è¥', player: 'blue', x: 7, y: 0, visible: true},
                {type: 'è¥', player: 'blue', x: 8, y: 0, visible: true},
                {type: 'è¿', player: 'blue', x: 9, y: 0, visible: true},
                {type: 'è¿', player: 'blue', x: 10, y: 0, visible: true},
                {type: 'æ’', player: 'blue', x: 1, y: 1, visible: true},
                {type: 'æ’', player: 'blue', x: 2, y: 1, visible: true},
                {type: 'å·¥', player: 'blue', x: 3, y: 1, visible: true},
                {type: 'å¼¹', player: 'blue', x: 4, y: 1, visible: true},
                {type: 'å¼¹', player: 'blue', x: 5, y: 1, visible: true},
                {type: 'é›·', player: 'blue', x: 2, y: 2, visible: true},
                {type: 'é›·', player: 'blue', x: 3, y: 2, visible: true},
                {type: 'é›·', player: 'blue', x: 4, y: 2, visible: true},
                {type: 'æ——', player: 'blue', x: 1, y: 2, visible: true}
            ];

            const redPieces = [
                {type: 'å¸', player: 'red', x: 1, y: 9, visible: false},
                {type: 'å†›', player: 'red', x: 2, y: 9, visible: false},
                {type: 'å¸ˆ', player: 'red', x: 3, y: 9, visible: false},
                {type: 'æ—…', player: 'red', x: 4, y: 9, visible: false},
                {type: 'å›¢', player: 'red', x: 5, y: 9, visible: false},
                {type: 'å›¢', player: 'red', x: 6, y: 9, visible: false},
                {type: 'è¥', player: 'red', x: 7, y: 9, visible: false},
                {type: 'è¥', player: 'red', x: 8, y: 9, visible: false},
                {type: 'è¿', player: 'red', x: 9, y: 9, visible: false},
                {type: 'è¿', player: 'red', x: 10, y: 9, visible: false},
                {type: 'æ’', player: 'red', x: 1, y: 8, visible: false},
                {type: 'æ’', player: 'red', x: 2, y: 8, visible: false},
                {type: 'å·¥', player: 'red', x: 3, y: 8, visible: false},
                {type: 'å¼¹', player: 'red', x: 4, y: 8, visible: false},
                {type: 'å¼¹', player: 'red', x: 5, y: 8, visible: false},
                {type: 'é›·', player: 'red', x: 2, y: 7, visible: false},
                {type: 'é›·', player: 'red', x: 3, y: 7, visible: false},
                {type: 'é›·', player: 'red', x: 4, y: 7, visible: false},
                {type: 'æ——', player: 'red', x: 1, y: 7, visible: false}
            ];

            return [...bluePieces, ...redPieces];
        }

        let pieces = initPieces();

        function drawBoard() {
            ctx.fillStyle = '#DEB887';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // ç”»æ ¼å­
            ctx.strokeStyle = '#000';
            ctx.lineWidth = 1;
            for (let y = 0; y < ROWS; y++) {
                for (let x = 0; x < COLS; x++) {
                    ctx.strokeRect(x * CELL_SIZE, y * CELL_SIZE, CELL_SIZE, CELL_SIZE);
                }
            }

            // ç”»é“è·¯çº¿ï¼ˆç²—çº¿ï¼‰
            ctx.lineWidth = 3;
            ctx.strokeStyle = '#666';
            // æ¨ªå‘é“è·¯
            for (let y = 1; y < ROWS - 1; y++) {
                ctx.beginPath();
                ctx.moveTo(CELL_SIZE, y * CELL_SIZE);
                ctx.lineTo((COLS - 1) * CELL_SIZE, y * CELL_SIZE);
                ctx.stroke();
            }
        }

        function drawPieces() {
            pieces.forEach(piece => {
                const x = piece.x * CELL_SIZE;
                const y = piece.y * CELL_SIZE;

                // ç”»æ£‹å­åº•è‰²
                ctx.fillStyle = piece.player === 'blue' ? '#4169E1' : '#DC143C';
                ctx.fillRect(x + 5, y + 5, CELL_SIZE - 10, CELL_SIZE - 10);
                ctx.strokeStyle = '#000';
                ctx.lineWidth = 2;
                ctx.strokeRect(x + 5, y + 5, CELL_SIZE - 10, CELL_SIZE - 10);

                // é€‰ä¸­é«˜äº®
                if (selectedPiece === piece) {
                    ctx.strokeStyle = '#FFD700';
                    ctx.lineWidth = 4;
                    ctx.strokeRect(x + 3, y + 3, CELL_SIZE - 6, CELL_SIZE - 6);
                }

                // ç”»æ–‡å­—
                ctx.font = 'bold 20px SimSun';
                ctx.fillStyle = '#FFF';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';

                if (piece.visible) {
                    ctx.fillText(piece.type, x + CELL_SIZE / 2, y + CELL_SIZE / 2);
                } else {
                    ctx.fillText('?', x + CELL_SIZE / 2, y + CELL_SIZE / 2);
                }
            });
        }

        function getPieceAt(x, y) {
            return pieces.find(p => p.x === x && p.y === y);
        }

        function canMoveTo(piece, toX, toY) {
            if (toX < 0 || toX >= COLS || toY < 0 || toY >= ROWS) return false;
            if (piece.type === 'æ——' || piece.type === 'é›·') return false;

            const target = getPieceAt(toX, toY);
            if (target && target.player === piece.player) return false;

            // ç®€åŒ–ç§»åŠ¨è§„åˆ™ï¼šåªèƒ½ç§»åŠ¨åˆ°ç›¸é‚»æ ¼
            const dx = Math.abs(toX - piece.x);
            const dy = Math.abs(toY - piece.y);
            return (dx === 1 && dy === 0) || (dx === 0 && dy === 1);
        }

        function battle(attacker, defender) {
            attacker.visible = true;
            defender.visible = true;

            const aRank = ranks[attacker.type];
            const dRank = ranks[defender.type];

            // æ——å­è¢«åƒï¼Œæ¸¸æˆç»“æŸ
            if (defender.type === 'æ——') {
                gameOver = true;
                statusElement.textContent = `${attacker.player === 'blue' ? 'è“æ–¹' : 'çº¢æ–¹'}è·èƒœï¼`;
                removePiece(defender);
                return true;
            }

            // ç‚¸å¼¹ï¼šåŒå½’äºå°½
            if (attacker.type === 'å¼¹' || defender.type === 'å¼¹') {
                removePiece(attacker);
                removePiece(defender);
                return false;
            }

            // åœ°é›·
            if (defender.type === 'é›·') {
                if (attacker.type === 'å·¥') {
                    removePiece(defender);
                    return true;
                } else {
                    removePiece(attacker);
                    return false;
                }
            }

            // æ­£å¸¸æˆ˜æ–—
            if (aRank > dRank) {
                removePiece(defender);
                return true;
            } else if (aRank < dRank) {
                removePiece(attacker);
                return false;
            } else {
                removePiece(attacker);
                removePiece(defender);
                return false;
            }
        }

        function removePiece(piece) {
            const index = pieces.indexOf(piece);
            if (index > -1) pieces.splice(index, 1);
        }

        function aiMove() {
            if (gameOver) return;

            const redPieces = pieces.filter(p => p.player === 'red' && p.type !== 'æ——' && p.type !== 'é›·');

            for (let i = 0; i < 20; i++) {
                if (redPieces.length === 0) break;

                const piece = redPieces[Math.floor(Math.random() * redPieces.length)];
                const moves = [
                    {x: piece.x + 1, y: piece.y},
                    {x: piece.x - 1, y: piece.y},
                    {x: piece.x, y: piece.y + 1},
                    {x: piece.x, y: piece.y - 1}
                ];

                for (const move of moves) {
                    if (canMoveTo(piece, move.x, move.y)) {
                        const target = getPieceAt(move.x, move.y);
                        if (target) {
                            battle(piece, target);
                        } else {
                            piece.x = move.x;
                            piece.y = move.y;
                        }
                        currentPlayer = 'blue';
                        turnElement.textContent = 'è“æ–¹å›åˆ';
                        draw();
                        return;
                    }
                }
            }

            currentPlayer = 'blue';
            turnElement.textContent = 'è“æ–¹å›åˆ';
            draw();
        }

        canvas.addEventListener('click', (e) => {
            if (gameOver || currentPlayer !== 'blue') return;

            const rect = canvas.getBoundingClientRect();
            const clickX = Math.floor((e.clientX - rect.left) / CELL_SIZE);
            const clickY = Math.floor((e.clientY - rect.top) / CELL_SIZE);

            const clickedPiece = getPieceAt(clickX, clickY);

            if (selectedPiece) {
                if (canMoveTo(selectedPiece, clickX, clickY)) {
                    const target = getPieceAt(clickX, clickY);
                    if (target) {
                        const won = battle(selectedPiece, target);
                        if (won && !gameOver) {
                            selectedPiece.x = clickX;
                            selectedPiece.y = clickY;
                        }
                    } else {
                        selectedPiece.x = clickX;
                        selectedPiece.y = clickY;
                    }

                    selectedPiece = null;
                    currentPlayer = 'red';
                    turnElement.textContent = 'çº¢æ–¹å›åˆ';
                    draw();

                    if (!gameOver) {
                        setTimeout(aiMove, 800);
                    }
                } else {
                    selectedPiece = clickedPiece && clickedPiece.player === 'blue' ? clickedPiece : null;
                    draw();
                }
            } else {
                if (clickedPiece && clickedPiece.player === 'blue') {
                    selectedPiece = clickedPiece;
                    draw();
                }
            }
        });

        function draw() {
            drawBoard();
            drawPieces();
        }

        function resetGame() {
            window.location.reload();
        }

        draw();
    </script>
</body>
</html>
